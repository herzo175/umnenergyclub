<% include ./partials/header %>

<script src="https://cdnjs.cloudflare.com/ajax/libs/slidesjs/3.0/jquery.slides.min.js"></script>

<style>
    .slidesjs-pagination {
        display:none;
    }
</style>

<div class="ui two column centered grid">
    <div class="column">
        <div id="slides">
            <% posts.forEach(function(post){ %>
                <% if (post.image === "") { %>
                    <% return %>
                <% } else { %>
                    <img class="ui centered medium image" style="display:none;" src="<%=post.image%>">
                <% } %>
            <% }) %>
            <a href="#" class="slidesjs-previous slidesjs-navigation" title="Previous" style="color:black;display:none;"><i class="chevron left icon"></i></a>
            <a href="#" class="slidesjs-next slidesjs-navigation" title="Next" style="color:black;display:none;"><i class="chevron right icon"></i></a>
        </div>
    </div>
</div>

<div class="ui horizontal divider">Posts</div>

<div class="ui two column centered grid">
    <div class="column">
        <% posts.forEach(function(post) { %>
            <% if (currentUser) { %>
                <% if (post.author.id.equals(currentUser._id) || currentUser.isOfficer === true) { %>
                <br><div class="ui header">
                    <%=post.title%>
                    <span style="float:right;">
                        <a href="/deletepost/<%=post._id%>?_method=DELETE" style="color:black;">
                            <i class="remove icon"></i>
                        </a>
                        <a href="/editpost/<%=post._id%>" style="color:black;">
                            <i class="edit icon"></i>
                        </a>
                    </span>
                </div>
                <% } %>
            <% } else { %>
            <br><div class="ui left floated header"><%=post.title%></div>
            <% } %>
        <div class="ui clearing divider"></div>
        <div class="ui medium image">
            <img src="<%=post.image%>">
        </div>
        <p><%=post.text%></p>
        <p>By <%=post.author.name%></p>
        <p>Posted <%=post.posted.toDateString()%></p>
        <div class="ui grid">
            <div class="one wide column"></div>
            <div class="ten wide column">
                <h5 class="ui left floated header">Comments:</h5>
                <div class="ui clearing divider"></div>
                <% if (currentUser) { %>
                <form class="ui form" action="/createcomment/<%=post._id%>" method="POST">
                    <div class="inline fields">
                        <div class="field">
                            <input type="text" name="comment[text]" placeholder="New Comment">
                        </div>
                        <div class="field">
                            <input type="submit" value="Submit" class="ui basic button violet">
                        </div>
                    </div>
                </form>
                <% } %>
                <% post.comments.forEach(function(comment) { %>
                    <% if (currentUser) { %>
                        <% if (comment.author.id.equals(currentUser._id) || currentUser.isOfficer === true) { %>
                        <h5 class="ui header">
                            <%=comment.author.name%>
                            <span style="float:right;">
                                <a href="/deletecomment/<%=comment._id%>?_method=DELETE" style="color:black;">
                                    <i class="remove icon"></i>
                                </a>
                            </span>
                        </h5>
                        <% } else { %>
                        <h5 class="ui header"><%=comment.author.name%></h5>
                        <% } %>
                    <% } else { %>
                    <h5 class="ui header"><%=comment.author.name%></h5>
                    <% } %>
                    <p><%=comment.text%></p>
                <% }) %>
            </div>
            <div class="five wide column"></div>
        </div>
        <% }); %>
    </div>
</div> 

<script>
    $(function(){
      $("#slides").slidesjs({
        width: 940,
        height: 528,
        play: {
          active: false,
            // [boolean] Generate the play and stop buttons.
            // You cannot use your own buttons. Sorry.
          effect: "fade",
            // [string] Can be either "slide" or "fade".
          interval: 5000,
            // [number] Time spent on each slide in milliseconds.
          auto: true,
            // [boolean] Start playing the slideshow on load.
          swap: true,
            // [boolean] show/hide stop and play buttons
          pauseOnHover: false,
            // [boolean] pause a playing slideshow on hover
          restartDelay: 2500
            // [number] restart delay on inactive slideshow
        },
        navigation: {
          active: false,
            // [boolean] Generates next and previous buttons.
            // You can set to false and use your own buttons.
            // User defined buttons must have the following:
            // previous button: class="slidesjs-previous slidesjs-navigation"
            // next button: class="slidesjs-next slidesjs-navigation"
          effect: "slide"
            // [string] Can be either "slide" or "fade".
        }
      });
    });
</script>

<% include ./partials/footer %>